<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的七中恋爱物语果然有问题 - GalGame网页版</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义主题 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#ff7e9e',    // 主色调：粉红色（GalGame经典色）
            secondary: '#8a63ff',  // 辅助色：紫色
            dark: '#1a103a',       // 深色背景
            light: '#f8f3ff',      // 浅色文本
            overlay: 'rgba(0,0,0,0.7)', // 遮罩色
          },
          fontFamily: {
            gal: ['"Noto Serif SC"', 'serif', '"Microsoft YaHei"'],
          },
          animation: {
            'fade-in': 'fadeIn 0.8s ease-in-out',
            'slide-up': 'slideUp 0.6s ease-out',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(50px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      }
      .text-shadow-lg {
        text-shadow: 0 4px 8px rgba(0,0,0,0.5);
      }
      .backdrop-blur {
        backdrop-filter: blur(8px);
      }
      .gal-border {
        border: 2px solid rgba(255,255,255,0.2);
        border-radius: 4px;
      }
      .dialog-box {
        background: linear-gradient(180deg, rgba(30,20,60,0.95) 0%, rgba(15,10,30,0.95) 100%);
      }
    }
  </style>
  
  <style>
    /* 基础样式 */
    body {
      overflow: hidden;
      background-color: #0a0618;
      font-family: 'Noto Serif SC', serif, 'Microsoft YaHei', sans-serif;
    }
    
    /* 角色立绘容器 */
    .character-container {
      transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
    }
    
    /* 选项按钮hover效果 */
    .choice-btn {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .choice-btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s ease;
    }
    
    .choice-btn:hover::after {
      left: 100%;
    }
    
    /* 滚动条美化 */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(255,126,158,0.6);
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255,126,158,0.8);
    }
  </style>
</head>

<body class="h-screen flex flex-col">
  <!-- 游戏主容器 -->
  <div id="game-container" class="flex-1 relative overflow-hidden">
    <!-- 背景图层 - 完整URL -->
    <div id="background" class="absolute inset-0 bg-cover bg-center transition-opacity duration-1000 opacity-100" 
         style="background-image: url('https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg');"></div>
    
    <!-- 角色立绘层 -->
    <div class="absolute inset-0 flex items-end justify-between p-8 md:p-12">
      <!-- 左侧角色：王朝洋 - 完整URL -->
      <div id="char-left" class="character-container w-1/3 md:w-1/4 opacity-0 transform translate-x-[-50px]">
        <img src="https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg" alt="王朝洋" class="w-full h-auto object-contain drop-shadow-2xl">
      </div>
      <!-- 右侧角色：李东凌 - 完整URL -->
      <div id="char-right" class="character-container w-1/3 md:w-1/4 opacity-0 transform translate-x-[50px]">
        <img src="https://duhengmaster.github.io/YuHengmaster.github.io/photo/ldl.jpg" alt="李东凌" class="w-full h-auto object-contain drop-shadow-2xl">
      </div>
    </div>
    
    <!-- 文本对话框 -->
    <div id="dialog-box" class="dialog-box absolute bottom-0 left-0 right-0 p-6 md:p-8 transform translate-y-[100%] transition-transform duration-500 gal-border">
      <div class="flex items-start gap-4">
        <!-- 角色头像：王朝洋 - 完整URL -->
        <div id="speaker-avatar" class="w-16 h-16 md:w-20 md:h-20 rounded-full overflow-hidden border-2 border-primary/50 hidden md:block">
          <img src="https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg" alt="角色头像" class="w-full h-full object-cover">
        </div>
        
        <!-- 对话内容区 -->
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-2">
            <span id="speaker-name" class="text-primary font-bold text-lg md:text-xl text-shadow">王朝洋</span>
            <span class="text-xs md:text-sm text-gray-400">[成都七中 2年A班]</span>
          </div>
          <div id="dialog-text" class="text-light text-base md:text-lg leading-relaxed mb-4 min-h-[60px]">
            放学后的天台，微风轻轻吹拂着。你怎么会在这里？平时很少有人来这个地方呢...
          </div>
          
          <!-- 选项区域 -->
          <div id="choices" class="grid gap-3 mt-4">
            <button class="choice-btn bg-primary/10 hover:bg-primary/20 text-light py-3 px-4 rounded gal-border text-left">
              <i class="fa fa-heart text-primary mr-2"></i>因为想和你单独见面
            </button>
            <button class="choice-btn bg-primary/10 hover:bg-primary/20 text-light py-3 px-4 rounded gal-border text-left">
              <i class="fa fa-book text-primary mr-2"></i>只是想找个安静的地方看书
            </button>
            <button class="choice-btn bg-primary/10 hover:bg-primary/20 text-light py-3 px-4 rounded gal-border text-left">
              <i class="fa fa-question-circle text-primary mr-2"></i>偶然路过而已，没想到会遇到你
            </button>
          </div>
        </div>
      </div>
      
      <!-- 控制栏 -->
      <div class="flex justify-between items-center mt-6 pt-4 border-t border-white/10">
        <div class="flex gap-4">
          <button id="save-btn" class="text-light hover:text-primary transition-colors">
            <i class="fa fa-save mr-1"></i> 存档
          </button>
          <button id="load-btn" class="text-light hover:text-primary transition-colors">
            <i class="fa fa-download mr-1"></i> 读档
          </button>
          <button id="settings-btn" class="text-light hover:text-primary transition-colors">
            <i class="fa fa-cog mr-1"></i> 设置
          </button>
        </div>
        <button id="next-btn" class="bg-primary/80 hover:bg-primary text-light py-2 px-6 rounded transition-colors">
          继续 <i class="fa fa-arrow-right ml-1"></i>
        </button>
      </div>
    </div>
  </div>
  
  <!-- 游戏菜单（默认隐藏） -->
  <div id="game-menu" class="fixed inset-0 bg-overlay backdrop-blur flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-dark p-8 rounded-lg gal-border w-11/12 max-w-md animate-slide-up">
      <h2 class="text-primary text-2xl font-bold mb-6 text-center">我的七中恋爱物语果然有问题</h2>
      
      <div class="grid gap-4">
        <button id="start-game" class="bg-primary hover:bg-primary/90 text-light py-3 rounded transition-colors text-lg">
          <i class="fa fa-play mr-2"></i> 开始游戏
        </button>
        <button id="continue-game" class="bg-secondary/80 hover:bg-secondary text-light py-3 rounded transition-colors text-lg">
          <i class="fa fa-history mr-2"></i> 继续游戏
        </button>
        <button id="game-settings" class="bg-gray-700 hover:bg-gray-600 text-light py-3 rounded transition-colors text-lg">
          <i class="fa fa-sliders mr-2"></i> 游戏设置
        </button>
        <button id="game-about" class="bg-gray-700 hover:bg-gray-600 text-light py-3 rounded transition-colors text-lg">
          <i class="fa fa-info-circle mr-2"></i> 关于游戏
        </button>
        <button id="close-menu" class="bg-gray-800 hover:bg-gray-700 text-light py-3 rounded transition-colors text-lg">
          <i class="fa fa-times mr-2"></i> 关闭菜单
        </button>
      </div>
    </div>
  </div>
  
  <!-- 存档/读档界面（默认隐藏） -->
  <div id="save-load-modal" class="fixed inset-0 bg-overlay backdrop-blur flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-dark p-6 rounded-lg gal-border w-11/12 max-w-2xl animate-slide-up">
      <div class="flex justify-between items-center mb-4">
        <h3 id="save-load-title" class="text-primary text-xl font-bold">存档管理</h3>
        <button id="close-save-load" class="text-gray-400 hover:text-white">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="flex mb-4 border-b border-white/10">
        <button id="save-tab" class="py-2 px-4 text-primary border-b-2 border-primary">存档</button>
        <button id="load-tab" class="py-2 px-4 text-gray-400 hover:text-white">读档</button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[60vh] overflow-y-auto p-2">
        <!-- 存档槽位 -->
        <div class="bg-dark/50 border border-white/10 rounded p-3 hover:border-primary transition-colors cursor-pointer">
          <div class="flex justify-between items-center mb-2">
            <span class="text-light">存档位 1</span>
            <span class="text-xs text-gray-400">2025-11-05 14:30</span>
          </div>
          <p class="text-sm text-gray-300 line-clamp-2">天台相遇 - 与王朝洋的第一次对话</p>
        </div>
        <div class="bg-dark/50 border border-white/10 rounded p-3 hover:border-primary transition-colors cursor-pointer">
          <div class="flex justify-between items-center mb-2">
            <span class="text-light">存档位 2</span>
            <span class="text-xs text-gray-400">无存档</span>
          </div>
          <p class="text-sm text-gray-500 line-clamp-2">点击创建新存档</p>
        </div>
        <div class="bg-dark/50 border border-white/10 rounded p-3 hover:border-primary transition-colors cursor-pointer">
          <div class="flex justify-between items-center mb-2">
            <span class="text-light">存档位 3</span>
            <span class="text-xs text-gray-400">无存档</span>
          </div>
          <p class="text-sm text-gray-500 line-clamp-2">点击创建新存档</p>
        </div>
        <div class="bg-dark/50 border border-white/10 rounded p-3 hover:border-primary transition-colors cursor-pointer">
          <div class="flex justify-between items-center mb-2">
            <span class="text-light">存档位 4</span>
            <span class="text-xs text-gray-400">无存档</span>
          </div>
          <p class="text-sm text-gray-500 line-clamp-2">点击创建新存档</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 设置界面（默认隐藏） -->
  <div id="settings-modal" class="fixed inset-0 bg-overlay backdrop-blur flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-dark p-6 rounded-lg gal-border w-11/12 max-w-md animate-slide-up">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-primary text-xl font-bold">游戏设置</h3>
        <button id="close-settings" class="text-gray-400 hover:text-white">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-6">
        <!-- 音量设置 -->
        <div>
          <label class="block text-light mb-2">背景音乐音量</label>
          <div class="flex items-center gap-4">
            <i class="fa fa-music text-primary"></i>
            <input type="range" min="0" max="100" value="80" class="w-full accent-primary" id="bgm-volume">
            <span class="text-light w-8 text-center">80%</span>
          </div>
        </div>
        
        <div>
          <label class="block text-light mb-2">音效音量</label>
          <div class="flex items-center gap-4">
            <i class="fa fa-volume-up text-primary"></i>
            <input type="range" min="0" max="100" value="100" class="w-full accent-primary" id="se-volume">
            <span class="text-light w-8 text-center">100%</span>
          </div>
        </div>
        
        <!-- 文本设置 -->
        <div>
          <label class="block text-light mb-2">文本速度</label>
          <select class="w-full bg-dark border border-white/20 text-light rounded p-2" id="text-speed">
            <option value="1">慢速</option>
            <option value="2" selected>中速</option>
            <option value="3">快速</option>
            <option value="4">瞬间显示</option>
          </select>
        </div>
        
        <!-- 显示设置 -->
        <div class="flex items-center justify-between">
          <span class="text-light">显示文本框边框</span>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" checked class="sr-only peer">
            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
          </label>
        </div>
        
        <div class="flex items-center justify-between">
          <span class="text-light">自动播放</span>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" class="sr-only peer">
            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
          </label>
        </div>
        
        <!-- 按钮区域 -->
        <div class="flex gap-3 pt-4 border-t border-white/10">
          <button class="flex-1 bg-gray-700 hover:bg-gray-600 text-light py-2 rounded transition-colors">
            重置默认
          </button>
          <button class="flex-1 bg-primary hover:bg-primary/90 text-light py-2 rounded transition-colors">
            保存设置
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 游戏状态管理 - 更新角色名称
    const gameState = {
      currentScene: 'intro',
      characterAffinity: {
        王朝洋: 0,
        李东凌: 0
      },
      saveSlots: [],
      textSpeed: 2, // 1=慢, 2=中, 3=快, 4=瞬间
      volumes: {
        bgm: 80,
        se: 100
      }
    };
    
    // DOM元素
    const elements = {
      gameContainer: document.getElementById('game-container'),
      background: document.getElementById('background'),
      charLeft: document.getElementById('char-left'),
      charRight: document.getElementById('char-right'),
      dialogBox: document.getElementById('dialog-box'),
      speakerName: document.getElementById('speaker-name'),
      speakerAvatar: document.getElementById('speaker-avatar'),
      dialogText: document.getElementById('dialog-text'),
      choices: document.getElementById('choices'),
      nextBtn: document.getElementById('next-btn'),
      saveBtn: document.getElementById('save-btn'),
      loadBtn: document.getElementById('load-btn'),
      settingsBtn: document.getElementById('settings-btn'),
      gameMenu: document.getElementById('game-menu'),
      startGame: document.getElementById('start-game'),
      continueGame: document.getElementById('continue-game'),
      gameSettings: document.getElementById('game-settings'),
      closeMenu: document.getElementById('close-menu'),
      saveLoadModal: document.getElementById('save-load-modal'),
      closeSaveLoad: document.getElementById('close-save-load'),
      saveTab: document.getElementById('save-tab'),
      loadTab: document.getElementById('load-tab'),
      settingsModal: document.getElementById('settings-modal'),
      closeSettings: document.getElementById('close-settings'),
      bgmVolume: document.getElementById('bgm-volume'),
      seVolume: document.getElementById('se-volume'),
      textSpeed: document.getElementById('text-speed')
    };
    
    // 游戏剧情数据 - 完善后续场景配置
    const gameScript = {
      intro: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg', // 完整URL
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 }, // 王朝洋
          right: { src: '', opacity: 0 } // 初始隐藏李东凌
        },
        dialogs: [
          {
            speaker: '王朝洋', // 原苏沐月
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg', // 完整URL
            text: '放学后的天台，微风轻轻吹拂着。你怎么会在这里？平时很少有人来这个地方呢...',
            choices: [
              {
                text: '因为想和你单独见面',
                nextScene: 'choice1_1',
                affinity: { 王朝洋: 5 }
              },
              {
                text: '只是想找个安静的地方看书',
                nextScene: 'choice1_2',
                affinity: { 王朝洋: 2 }
              },
              {
                text: '偶然路过而已，没想到会遇到你',
                nextScene: 'choice1_3',
                affinity: { 王朝洋: 1 }
              }
            ]
          }
        ]
      },
      choice1_1: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg', // 完整URL
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 }, // 王朝洋
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg', // 完整URL
            text: '诶？！单、单独见面？（脸颊泛起红晕）你...你突然这么说，我有点不知所措呢...',
            choices: []
          },
          {
            speaker: '李玹玙', // 男主名称
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg', // 完整URL
            text: '抱歉，是不是太直接了？其实我关注你很久了。',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg', // 完整URL
            text: '（轻轻低下头，手指绞着裙摆）我...我其实也...',
            choices: [
              {
                text: '你其实也喜欢我吗？',
                nextScene: 'choice2_1',
                affinity: { 王朝洋: 8 }
              },
              {
                text: '慢慢说，不用着急',
                nextScene: 'choice2_2',
                affinity: { 王朝洋: 4 }
              }
            ]
          }
        ]
      },
      // 完善 choice2_1 场景（直接询问）
      choice2_1: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '（猛地抬起头，眼睛里闪着泪光）嗯...从高一第一次见到你在图书馆帮同学捡书的时候，我就...我就喜欢上你了！',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '（轻轻握住她的手）我也是，王朝洋。可以做我的女朋友吗？',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '（用力点头，泪水滑落脸颊）嗯！我愿意！',
            choices: [
              {
                text: '拥抱她',
                nextScene: 'happy_end1',
                affinity: { 王朝洋: 10 }
              },
              {
                text: '轻声安慰她',
                nextScene: 'happy_end2',
                affinity: { 王朝洋: 5 }
              }
            ]
          }
        ]
      },
      // 完善 choice2_2 场景（温柔等待）
      choice2_2: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '（抬起头，眼神温柔而坚定）我其实也关注你很久了。你的认真、你的善良，我都看在眼里。',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '那...你愿意和我交往吗？',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '（微笑着点头）嗯，我愿意。以后请多指教啦，李玹玙同学～',
            choices: [
              {
                text: '约她周末一起去看电影',
                nextScene: 'happy_end3',
                affinity: { 王朝洋: 8 }
              },
              {
                text: '约她一起去图书馆学习',
                nextScene: 'happy_end4',
                affinity: { 王朝洋: 6 }
              }
            ]
          }
        ]
      },
      // 完善 choice1_2 场景（看书选项）
      choice1_2: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg', // 完整URL
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 }, // 王朝洋
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg', // 完整URL
            text: '原来如此，天台确实是个安静的好地方呢。你在看什么书？',
            choices: [
              {
                text: '是你喜欢的文学类书籍',
                nextScene: 'choice2_3',
                affinity: { 王朝洋: 4 }
              },
              {
                text: '只是普通的教科书，想预习一下',
                nextScene: 'choice2_4',
                affinity: { 王朝洋: 1 }
              }
            ]
          }
        ]
      },
      // 完善 choice2_3 场景（文学书籍）
      choice2_3: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '哇！这本书我也很喜欢！作者的文字真的很有感染力呢～',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '我记得你之前在语文课上推荐过这本书，所以特意找来看看。',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '（惊讶地睁大眼睛）你居然记得我说过的话...（脸颊微红）那...以后我们可以一起讨论这本书吗？',
            choices: [
              {
                text: '当然可以，随时都可以',
                nextScene: 'friend_to_love1',
                affinity: { 王朝洋: 6 }
              },
              {
                text: '好啊，周末一起去书店看看吧',
                nextScene: 'friend_to_love2',
                affinity: { 王朝洋: 4 }
              }
            ]
          }
        ]
      },
      // 完善 choice2_4 场景（教科书）
      choice2_4: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '你真用功呢～ 其实我这科也不太好，有机会可以一起学习吗？',
            choices: [
              {
                text: '好啊，明天放学后一起去图书馆',
                nextScene: 'study_together1',
                affinity: { 王朝洋: 3 }
              },
              {
                text: '没问题，有不懂的可以问我',
                nextScene: 'study_together2',
                affinity: { 王朝洋: 2 }
              }
            ]
          }
        ]
      },
      // 完善 choice1_3 场景（偶然路过）
      choice1_3: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg', // 完整URL
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 }, // 王朝洋
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg', // 完整URL
            text: '这样啊，真是巧合呢。我经常来这里散心，看着远处的风景，心情会变好很多。',
            choices: [
              {
                text: '我可以经常来这里陪你吗？',
                nextScene: 'choice2_5',
                affinity: { 王朝洋: 3 }
              },
              {
                text: '这里的风景确实很不错',
                nextScene: 'choice2_6',
                affinity: { 王朝洋: 1 }
              }
            ]
          }
        ]
      },
      // 完善 choice2_5 场景（陪她散心）
      choice2_5: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '（有些害羞）可、可以啊... 有个人陪我说话，应该会更开心吧',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '那以后每天放学后，我都来这里找你吧',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '嗯！（露出微笑）对了，我带了自制的饼干，要不要尝尝？',
            choices: [
              {
                text: '好啊，谢谢你',
                nextScene: 'daily_chat1',
                affinity: { 王朝洋: 4 }
              },
              {
                text: '哇，看起来很好吃！',
                nextScene: 'daily_chat2',
                affinity: { 王朝洋: 3 }
              }
            ]
          }
        ]
      },
      // 完善 choice2_6 场景（赞美风景）
      choice2_6: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '对吧～ 尤其是夕阳西下的时候，整个校园都被染成金色，超级美的',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '下次有机会想看看你说的夕阳',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '那明天放学后我在这里等你吧？一起看夕阳',
            choices: [
              {
                text: '好，不见不散',
                nextScene: 'sunset_date1',
                affinity: { 王朝洋: 3 }
              },
              {
                text: '没问题，我会准时到',
                nextScene: 'sunset_date2',
                affinity: { 王朝洋: 2 }
              }
            ]
          }
        ]
      },
      // 结局场景（示例）
      happy_end1: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school_garden.jpg', // 校园花园背景
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg', opacity: 1 } // 显示男主
        },
        dialogs: [
          {
            speaker: '旁白',
            avatar: '',
            text: '夕阳下的天台，两个相爱的人紧紧相拥。他们的恋爱故事，从此开始...',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '王朝洋，谢谢你愿意接受我。我会一直喜欢你的',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '我也是... 以后请多关照啦，男朋友～',
            choices: [
              {
                text: '游戏结束（达成：甜蜜结局）',
                nextScene: 'game_end',
                affinity: {}
              }
            ]
          }
        ]
      },
      happy_end2: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school_garden.jpg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg', opacity: 1 }
        },
        dialogs: [
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '别哭啦，以后我会一直陪着你的',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '嗯... 有你在真好',
            choices: []
          },
          {
            speaker: '旁白',
            avatar: '',
            text: '温柔的陪伴是最长情的告白，他们的故事将在往后的日子里慢慢延续...',
            choices: [
              {
                text: '游戏结束（达成：温柔结局）',
                nextScene: 'game_end',
                affinity: {}
              }
            ]
          }
        ]
      },
      // 其他结局场景（简化示例）
      happy_end3: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/cinema.jpg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg', opacity: 1 }
        },
        dialogs: [
          {
            speaker: '旁白',
            avatar: '',
            text: '周末的电影院，他们一起看完了最新上映的爱情电影。',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '电影真好看，谢谢你邀请我',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '能和你一起看，才是最好的',
            choices: [
              {
                text: '游戏结束（达成：约会结局）',
                nextScene: 'game_end',
                affinity: {}
              }
            ]
          }
        ]
      },
      happy_end4: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/library.jpg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg', opacity: 1 }
        },
        dialogs: [
          {
            speaker: '旁白',
            avatar: '',
            text: '图书馆里，他们一起学习，偶尔相视一笑，岁月静好。',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '和你一起学习，效率都变高了呢',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '因为有你在身边啊',
            choices: [
              {
                text: '游戏结束（达成：学霸结局）',
                nextScene: 'game_end',
                affinity: {}
              }
            ]
          }
        ]
      },
      friend_to_love1: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/bookstore.jpg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg', opacity: 1 }
        },
        dialogs: [
          {
            speaker: '旁白',
            avatar: '',
            text: '从文学讨论开始，他们的关系逐渐升温，友情慢慢变成了爱情。',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lezi.jpg',
            text: '李玹玙，其实...我喜欢你很久了',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg',
            text: '我也是，王朝洋',
            choices: [
              {
                text: '游戏结束（达成：知己结局）',
                nextScene: 'game_end',
                affinity: {}
              }
            ]
          }
        ]
      },
      game_end: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/graduation.jpg',
        characters: {
          left: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/wcy.jpg', opacity: 1 },
          right: { src: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/lxy.jpg', opacity: 1 }
        },
        dialogs: [
          {
            speaker: '旁白',
            avatar: '',
            text: '恭喜你完成本次游戏！感谢你的游玩～',
            choices: [
              {
                text: '重新开始',
                nextScene: 'intro',
                affinity: {}
              },
              {
                text: '返回主菜单',
                nextScene: 'main_menu',
                affinity: {}
              }
            ]
          }
        ]
      },
      main_menu: {
        background: 'https://duhengmaster.github.io/YuHengmaster.github.io/photo/school.jpeg',
        characters: {
          left: { src: '', opacity: 0 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '系统',
            avatar: '',
            text: '是否返回主菜单？',
            choices: [
              {
                text: '返回主菜单',
                nextScene: 'return_menu',
                affinity: {}
              },
              {
                text: '继续游戏',
                nextScene: 'intro',
                affinity: {}
              }
            ]
          }
        ]
      }
    };
    
    // 初始化游戏
    function initGame() {
      // 显示游戏菜单
      showGameMenu(true);
      
      // 绑定事件监听
      bindEventListeners();
      
      // 加载存档数据
      loadSaveData();
    }
    
    // 绑定事件监听
    function bindEventListeners() {
      // 菜单相关
      elements.startGame.addEventListener('click', startNewGame);
      elements.continueGame.addEventListener('click', continueGame);
      elements.gameSettings.addEventListener('click', () => showSettings(true));
            choice1_2: {
        background: './photo/school.jpeg',
        characters: {
          left: { src: './photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: './photo/lezi.jpg',
            text: '原来是这样啊...这里确实很安静呢，风也很舒服。',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: './photo/lezi.jpg',
            text: '你在看什么书呢？可以给我看看吗？',
            choices: [
              {
                text: '递给她看，并邀请一起阅读',
                nextScene: 'choice2_3',
                affinity: { 王朝洋: 4 }
              },
              {
                text: '有点不好意思地说这是漫画',
                nextScene: 'choice2_4',
                affinity: { 王朝洋: 2 }
              }
            ]
          }
        ]
      },
      choice1_3: {
        background: './photo/school.jpeg',
        characters: {
          left: { src: './photo/wcy.jpg', opacity: 1 },
          right: { src: '', opacity: 0 }
        },
        dialogs: [
          {
            speaker: '王朝洋',
            avatar: './photo/lezi.jpg',
            text: '这样啊...我经常来这里午休，感觉这里很舒服。',
            choices: []
          },
          {
            speaker: '李玹玙',
            avatar: './photo/lxy.jpg',
            text: '确实，比教室安静多了。',
            choices: []
          },
          {
            speaker: '王朝洋',
            avatar: './photo/lezi.jpg',
            text: '对了，下周的文化祭，你有什么打算吗？',
            choices: [
              {
                text: '还没想法，你有什么建议吗？',
                nextScene: 'choice2_5',
                affinity: { 王朝洋: 3 }
              },
              {
                text: '打算和朋友一起参加活动',
                nextScene: 'choice2_6',
                affinity: { 王朝洋: 1 }
              }
            ]
          }
        ]
      },
      // 后续场景可以继续在这里添加...
    };
    
    // 初始化游戏
    function initGame() {
      // 显示游戏菜单
      showElement(elements.gameMenu);
      
      // 绑定事件监听器
      bindEventListeners();
    }
    
    // 开始新游戏
    function startNewGame() {
      hideElement(elements.gameMenu);
      setTimeout(() => {
        showElement(elements.dialogBox);
        loadScene('intro');
      }, 300);
    }
    
    // 加载场景
    function loadScene(sceneName) {
      const scene = gameScript[sceneName];
      if (!scene) return;
      
      gameState.currentScene = sceneName;
      
      // 更新背景
      elements.background.style.backgroundImage = `url('${scene.background}')`;
      
      // 更新角色
      updateCharacter(elements.charLeft, scene.characters.left);
      updateCharacter(elements.charRight, scene.characters.right);
      
      // 加载对话
      loadDialogs(scene.dialogs, 0);
    }
    
    // 更新角色显示
    function updateCharacter(element, charData) {
      if (charData.src) {
        element.querySelector('img').src = charData.src;
        element.style.opacity = charData.opacity;
        element.style.transform = 'translateX(0)';
      } else {
        element.style.opacity = 0;
        element.style.transform = element.id === 'char-left' ? 'translateX(-50px)' : 'translateX(50px)';
      }
    }
    
    // 加载对话
    function loadDialogs(dialogs, index) {
      if (index >= dialogs.length) {
        // 对话结束，检查是否有下一场景
        return;
      }
      
      const dialog = dialogs[index];
      
      // 更新对话者信息
      elements.speakerName.textContent = dialog.speaker;
      elements.speakerAvatar.querySelector('img').src = dialog.avatar;
      
      // 清空选项
      elements.choices.innerHTML = '';
      
      // 显示对话文本（带打字效果）
      typeText(elements.dialogText, dialog.text, 0, () => {
        // 文本显示完成后显示选项或继续按钮
        if (dialog.choices && dialog.choices.length > 0) {
          // 显示选项
          showChoices(dialog.choices);
          elements.nextBtn.style.display = 'none';
        } else {
          // 显示继续按钮
          elements.nextBtn.style.display = 'block';
          elements.nextBtn.onclick = () => loadDialogs(dialogs, index + 1);
        }
      });
    }
    
    // 打字效果
    function typeText(element, text, index, callback) {
      if (index < text.length) {
        element.textContent = text.substring(0, index + 1);
        // 根据文本速度调整延迟
        const delay = [100, 50, 20, 0][gameState.textSpeed - 1];
        setTimeout(() => typeText(element, text, index + 1, callback), delay);
      } else {
        if (callback) callback();
      }
    }
    
    // 显示选项
    function showChoices(choices) {
      choices.forEach(choice => {
        const button = document.createElement('button');
        button.className = 'choice-btn bg-primary/10 hover:bg-primary/20 text-light py-3 px-4 rounded gal-border text-left';
        button.innerHTML = `<i class="fa fa-heart text-primary mr-2"></i>${choice.text}`;
        
        button.addEventListener('click', () => {
          // 更新好感度
          if (choice.affinity) {
            for (const char in choice.affinity) {
              gameState.characterAffinity[char] += choice.affinity[char];
            }
          }
          // 加载下一场景
          loadScene(choice.nextScene);
        });
        
        elements.choices.appendChild(button);
      });
    }
    
    // 显示元素
    function showElement(element) {
      element.classList.remove('opacity-0', 'pointer-events-none');
      if (element.id === 'dialog-box') {
        element.style.transform = 'translateY(0)';
      }
    }
    
    // 隐藏元素
    function hideElement(element) {
      element.classList.add('opacity-0', 'pointer-events-none');
      if (element.id === 'dialog-box') {
        element.style.transform = 'translateY(100%)';
      }
    }
    
    // 绑定事件监听器
    function bindEventListeners() {
      // 菜单按钮
      elements.startGame.addEventListener('click', startNewGame);
      elements.continueGame.addEventListener('click', () => {
        hideElement(elements.gameMenu);
        setTimeout(() => showElement(elements.dialogBox), 300);
      });
      elements.gameSettings.addEventListener('click', () => {
        hideElement(elements.gameMenu);
        showElement(elements.settingsModal);
      });
      elements.closeMenu.addEventListener('click', () => hideElement(elements.gameMenu));
      
      // 存档/读档按钮
      elements.saveBtn.addEventListener('click', () => showElement(elements.saveLoadModal));
      elements.loadBtn.addEventListener('click', () => {
        showElement(elements.saveLoadModal);
        elements.saveTab.classList.remove('text-primary', 'border-primary', 'border-b-2');
        elements.saveTab.classList.add('text-gray-400');
        elements.loadTab.classList.add('text-primary', 'border-primary', 'border-b-2');
        elements.loadTab.classList.remove('text-gray-400');
        elements.saveLoadTitle.textContent = '读档管理';
      });
      elements.closeSaveLoad.addEventListener('click', () => hideElement(elements.saveLoadModal));
      
      // 存档/读档标签切换
      elements.saveTab.addEventListener('click', () => {
        elements.saveTab.classList.add('text-primary', 'border-primary', 'border-b-2');
        elements.saveTab.classList.remove('text-gray-400');
        elements.loadTab.classList.remove('text-primary', 'border-primary', 'border-b-2');
        elements.loadTab.classList.add('text-gray-400');
        elements.saveLoadTitle.textContent = '存档管理';
      });
      
      elements.loadTab.addEventListener('click', () => {
        elements.loadTab.classList.add('text-primary', 'border-primary', 'border-b-2');
        elements.loadTab.classList.remove('text-gray-400');
        elements.saveTab.classList.remove('text-primary', 'border-primary', 'border-b-2');
        elements.saveTab.classList.add('text-gray-400');
        elements.saveLoadTitle.textContent = '读档管理';
      });
      
      // 设置按钮
      elements.settingsBtn.addEventListener('click', () => showElement(elements.settingsModal));
      elements.closeSettings.addEventListener('click', () => hideElement(elements.settingsModal));
      
      // 音量滑块
      elements.bgmVolume.addEventListener('input', (e) => {
        const value = e.target.value;
        e.target.nextElementSibling.textContent = `${value}%`;
        gameState.volumes.bgm = parseInt(value);
        // 这里可以添加实际调整音量的代码
      });
      
      elements.seVolume.addEventListener('input', (e) => {
        const value = e.target.value;
        e.target.nextElementSibling.textContent = `${value}%`;
        gameState.volumes.se = parseInt(value);
        // 这里可以添加实际调整音量的代码
      });
      
      // 文本速度选择
      elements.textSpeed.addEventListener('change', (e) => {
        gameState.textSpeed = parseInt(e.target.value);
      });
    }
    
    // 游戏启动
    window.addEventListener('DOMContentLoaded', initGame);
  </script>
</body>
</html>
